<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Explanio- Automatically generated by Explanio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link rel="icon" type="image/png"
    href="https://cdn.vocallabs.ai/landing_page/a2b0cd13-51fb-49ae-80fb-a9a245053d25.png" />
  <style>
    @import url("https://fonts.googleapis.com/css?family=Roboto:400|Inter:400,500,700,600");
    @import url("https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300;400;500;600;700;800&display=swap");
  </style>
  <link href="tailwind.css" rel="stylesheet" />
  <link href="tailwind.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/@cap.js/widget"></script>
  <script>
    (function () {
      console.log('[CAP.js] Initializing with challenge/redeem flow...');
      window.capInstance = {
        apiEndpoint: 'https://cap.subspace.money/d0e3be2d27',
        getToken: async function () {
          console.log('[CAP.js] Starting full challenge/redeem flow...');
          try {
            // Step 1: Get challenge
            const challengeResponse = await fetch(`${this.apiEndpoint}/challenge`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({})
            });
            if (!challengeResponse.ok) {
              throw new Error(`Challenge failed: ${challengeResponse.status}`);
            }
            const challengeData = await challengeResponse.json();
            console.log('[CAP.js] Challenge received:', challengeData);
            // Step 2: Use widget solver
            const capWidget = document.querySelector('cap-widget');
            if (capWidget && typeof capWidget.solve === 'function') {
              console.log('[CAP.js] Step 2: Using widget solver...');
              const solverResult = await capWidget.solve(challengeData);
              console.log('[CAP.js] Widget solver result:', solverResult);

              if (solverResult && solverResult.success && solverResult.token) {
                console.log('[CAP.js] ✅ Using token from widget solver:', solverResult.token);
                return solverResult.token;
              }
            }
            // Step 3: Fallback - manual redeem
            console.log('[CAP.js] Step 3: Manual redeem fallback...');
            const redeemResponse = await fetch(`${this.apiEndpoint}/redeem`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                token: challengeData.token || challengeData.challenge,
                solutions: []
              })
            });
            if (!redeemResponse.ok) {
              throw new Error(`Redeem failed: ${redeemResponse.status}`);
            }
            const redeemData = await redeemResponse.json();
            const finalToken = redeemData.token || redeemData.captcha_token || JSON.stringify(redeemData);
            console.log('[CAP.js] ✅ Final token obtained:', finalToken);
            return finalToken;
          } catch (error) {
            console.error('[CAP.js] Error in flow:', error);
            throw error;
          }
        },
        ready: true
      };
      console.log('[CAP.js] ✅ CAP instance initialized and ready');
    })();
  </script>
</head>

<body>
  <cap-widget data-cap-api-endpoint="https://cap.subspace.money/d0e3be2d27/" data-invisible="true"
    style="display: none;"></cap-widget>
  <div id="app"></div>
  <script type="module" src="./src/index.tsx"></script>
</body>

</html>